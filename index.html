<!DOCTYPE html>
<html>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=0.8, maximum-scale=0.8, user-scalable=no" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

<head>
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css" />
	<link rel="stylesheet" href="https://unpkg.com/ion-rangeslider@2.2.0/css/ion.rangeSlider.css" />
	<link rel="stylesheet" href="https://unpkg.com/ion-rangeslider@2.2.0/css/ion.rangeSlider.skinNice.css" />
	<link rel="stylesheet" href="css/leaflet.css" />
	<link rel="stylesheet" href="css/leaflet-panel-layers.css" />
	<link rel="stylesheet" href="css/L.Control.HtmlLegend.css" />
	<link rel="stylesheet" href="css/leaflet-search.css" />


	<script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"></script>
	<script src="js/leaflet-panel-layers.src.js"></script>
	<script src="js/leaflet-panel-layers.js"></script>
	<script src="js/L.Control.Appearance.js"></script>
	<script src="js/jquery-3.5.1.js"></script>
	<script src="js/L.Control.HtmlLegend.js"></script>
	<script src="js/leaflet-search.js"></script>

	<!-- en la Carpeta DATA estan los js como capas-->
	<script type="text/javascript" src="data/catastros.js"></script>
	<script type="text/javascript" src="data/dpto.js"></script>
	<script type="text/javascript" src="data/mesasdelagua.js"></script>
	<script type="text/javascript" src="data/escuelas.js"></script>
	<script type="text/javascript" src="data/puestosdata.js"></script>
	<style>
		#map {
			width: 100%;
			height: 600px;
			box-shadow: 5px 5px 5px #888;
		}

		.info {
			padding: 6px 8px;
			font: 14px/16px Arial, Helvetica, sans-serif;
			background: white;
			background: rgba(255, 255, 255, 0.8);
			box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
			border-radius: 5px;
		}

		.info h2 {
			margin: 0 0 5px;
			color: #777;
		}

		.leaflet-tooltip.my-labels {
			background-color: transparent;
			border: transparent;
			box-shadow: none;
		}

		/* Estilos CSS para la leyenda */
		.info.legend {
			background: white;
			padding: 10px;
			border: 1px solid #ccc;
			border-radius: 5px;
			font-size: 12px;
		}

		/* Estilos para los círculos de colores en la leyenda */
		.info.legend i {
			width: 12px;
			height: 12px;
			display: inline-block;
			border-radius: 50%;
			margin-right: 5px;
		}
	</style>

</head>

<body>


	<div id="map"></div>

	<script>

		// con VAR se crean las capas basese a visualizar => L.tileLayer.wms es la propiedad que tare los TileLayer y/o wms //
		var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
			attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a>',
			maxZoom: 18
		});

		var google = L.tileLayer('https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
			opacity: 1.0,
			attribution: '&copy;<a href="https://www.google.at/permissions/geoguidelines/attr-guide.html">Google</a>',
			maxZoom: 18
		});


		// Crear una capa GeoJSON y añadir al mapa
		var catastrosL = L.geoJSON(catastros, {
			style: styleCatastro,
			onEachFeature: function (feature, layer) {
				var content = popupContent(feature);
				layer.bindPopup(content);
			}
		});

		var RBN = L.geoJSON(rbn, {
			style: styleDpto,
			onEachFeature: function (feature, layer) {
				var content = popupContentData(feature);
				layer.bindPopup(content);
			}
		});
		var RBS = L.geoJSON(rbs, {
			style: styleDpto,
			onEachFeature: function (feature, layer) {
				var content = popupContentData(feature);
				layer.bindPopup(content);
			}
		});
		var DEPTO = L.geoJSON(depto, {
			style: styleDpto,
			onEachFeature: function (feature, layer) {
				var content = popupContentData(feature);
				layer.bindPopup(content);
			}
		});

		var MESAS = L.geoJSON(mesa, {

			onEachFeature: function (feature, layer) {
				var content = popupContentMesa(feature);
				layer.bindPopup(content);
			}
		});

		var ESC = L.geoJSON(escuelas, {
			pointToLayer: function (feature, latlng){
				return L.circleMarker(latlng, MarkerESC);
			},
			style: styleESC,
	
			onEachFeature: function (feature, layer) {
				var content = popupContentEsc(feature);
				layer.bindPopup(content);
			}
		});

		var PUESTOS = L.geoJSON(puestos, {
			pointToLayer: function (feature, latlng) {
				return L.circleMarker(latlng, MarkerOptions);
			},
			style: stylePuestos,
			onEachFeature: function (feature, layer) {
				var content = popupContentPuestos(feature);
				layer.bindPopup(content);
			}
		});
		//mapa//
		var map = L.map('map', {
			center: [-23.52030, -62.82378],
			zoom: 8,
			zoomControl: false,
			layers: [google, RBN, RBS]

		});
		// Grupos de capas
		var baseLayers = [
			{
				name: "Open Street Map",
				layer: osm,
			},
			{
				name: "Google Satelite",
				layer: google
			}];

		var overlayMaps = [
			{
				group: "Linea de base",
				layers: [

					{
						active: false,
						name: "Departamento",
						layer: DEPTO,
						transparent: true,
						opacity: 0.5,
					},
					{
						active: false,
						name: "Rivadavia Banda Norte",
						layer: RBN,
						transparent: true,
						opacity: 0.5,
					}, {
						active: false,
						name: "Rivadavia Banda Sur",
						layer: RBS,
						transparent: true,
						opacity: 0.5,
					},
					{
						active: false,
						name: "Catastros",
						layer: catastrosL,
						transparent: true,
						opacity: 0.5,
					},
				]
			},
			{
				group: "Info de Agua",
				layers: [

					{
						active: false,
						name: "Mesas del agua",
						layer: MESAS,
						transparent: true,
						opacity: 0.5,
					},
					{
						active: false,
						name: "Escuelas",
						layer: ESC,
						transparent: true,
						opacity: 0.5,
					},


				]
			},
			{
				group: "Acceso al Agua",
				layers: [
					{
						active: false,
						name: "Acceso al agua por Puesto o Comunidad",
						layer: PUESTOS,
						transparent: true,
						opacity: 0.5,
					},

				]
			}
		];



		// colocar el logo 
		L.Control.Watermark = L.Control.extend({
			onAdd: function (map) {
				var img = L.DomUtil.create('img');
				img.src = 'images/logow.png';
				img.style.width = '20vh', // vh para que sea responsive
				img.style.height = 'auto'; // auto para que sera responsive
				return img;
			},
			onRemove: function (map) { },
		});
		L.control.watermark = function (opts) {
			return new L.Control.Watermark(opts);
		}
		L.control.watermark(position = 'topleft').addTo(map);

		var panelLayers = new L.Control.PanelLayers(baseLayers, null,
			{
				compact: true,
				collapsed: false,
				collapsibleGroups: true,
				position: 'topleft',
			});
		map.addControl(panelLayers);
		//panel de control agregado//
		var panelLayers1 = new L.Control.PanelLayers(null, overlayMaps,
			{
				compact: true,
				//collapsed: true,
				collapsibleGroups: true,
				position: 'topleft',
			});
		map.addControl(panelLayers1);
		//panel de control agregado//


		// Insertando buscador

		var title = L.control(
		);
		title.onAdd = function (map) {
			var div = L.DomUtil.create('div', 'info');
			div.innerHTML +=
				'<h2>Buscador </h2> ';
			return div;
		};
		title.addTo(map);

		// //buscador de datos. Solo para datos que sean json o geojson

		var searchControl = new L.Control.Search({
			layer: PUESTOS,
			propertyName: 'TIPO_ABAST',
			circleLocation: false,
			position: 'topright',
			collapsed: false
		});

		map.addControl(searchControl);

		searchControl.on('search:locationfound', function (e) {
			var tipoAbastecimiento = e.text; // Tipo de abastecimiento buscado

			// Restaurar el estilo de todas las capas
			PUESTOS.eachLayer(function (layer) {
				PUESTOS.resetStyle(layer);
			});

			// Iterar sobre todas las capas y resaltar las que coinciden con el tipo de abastecimiento buscado
			PUESTOS.eachLayer(function (layer) {
				if (layer.feature.properties.TIPO_ABAST === tipoAbastecimiento) {
					layer.setStyle({ fillColor: '#3f0', color: '#6bbdc9' });
				}
			});
		}).on('search:collapsed', function (e) {
			// Restaurar el estilo de todas las capas al cerrar la búsqueda
			PUESTOS.eachLayer(function (layer) {
				PUESTOS.resetStyle(layer);
			});
		});


		// Llamada a la función para crear la leyenda
		createLegend();





		//se le agregan los controles//
		L.control.zoom({ position: 'topright' }).addTo(map);
		L.control.scale({ position: 'bottomleft', imperial: false }).addTo(map);
	</script>

</body>

</html>
